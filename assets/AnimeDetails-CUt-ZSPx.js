import{j as e,c as z}from"./index-Cy-imd_x.js";import{f as q,d as U,b as r,L as Q}from"./vendor-Btvvx3Fo.js";import{G as X}from"./ui-BeglVYDV.js";const H=new X({apiKey:"PLACEHOLDER_API_KEY"}),Z={getAnimeInsight:async(x,c)=>{var f,t,p,i;try{const d=await H.models.generateContent({model:"gemini-3-flash-preview",contents:`Research the anime "${x}" using Google Search. 
        Provide a short, exciting "hook" why someone should watch it based on latest critical reception.
        List 3 highly similar anime that are popular right now.
        
        Format your response strictly as:
        HOOK: [your hook here]
        SIMILAR: [Anime 1], [Anime 2], [Anime 3]`,config:{tools:[{googleSearch:{}}]}}),m=d.text||"",g=m.match(/HOOK:\s*(.*)/i),n=m.match(/SIMILAR:\s*(.*)/i),u=((i=(p=(t=(f=d.candidates)==null?void 0:f[0])==null?void 0:t.groundingMetadata)==null?void 0:p.groundingChunks)==null?void 0:i.map(l=>l.web).filter(Boolean))||[];return{data:{hook:g?g[1].trim():"Experience a masterclass in storytelling and animation.",similar:n?n[1].split(",").map(l=>l.trim()):[]},sources:u}}catch(d){return console.error("Gemini Insight Error:",d),null}},discoverAnime:async x=>{var c,f,t,p;try{const i=await H.models.generateContent({model:"gemini-3-flash-preview",contents:`The user wants anime recommendations based on this vibe: "${x}". 
        Use Google Search to find current, trending, or highly-rated anime that fit this description perfectly.
        Provide 4 recommendations.
        
        Format each item as:
        TITLE: [Anime Name]
        REASON: [Short compelling reason]`,config:{tools:[{googleSearch:{}}]}}),m=(i.text||"").split(/TITLE:/i).filter(n=>n.trim()).map(n=>{const u=n.split(`
`),l=u[0].trim(),w=u.find(y=>y.toUpperCase().includes("REASON:")),A=w?w.replace(/REASON:/i,"").trim():"Highly recommended for your current mood.";return{title:l,reason:A}}),g=((p=(t=(f=(c=i.candidates)==null?void 0:c[0])==null?void 0:f.groundingMetadata)==null?void 0:t.groundingChunks)==null?void 0:p.map(n=>n.web).filter(Boolean))||[];return{data:m.slice(0,4),sources:g}}catch(i){return console.error("Discovery Error:",i),null}}},ee=({isActive:x})=>{const[c,f]=r.useState(Array(60).fill(10)),[t,p]=r.useState(0),i=r.useRef(null),d=r.useRef(0),m=r.useRef(0),g=n=>{d.current=n/1e3;const u=x?1:.15;m.current+=(u-m.current)*.05;const l=m.current,w=Array.from({length:60},(A,y)=>{const S=y/60*8,T=Math.sin(d.current*2+S)*10,v=Math.sin(d.current*8+y*.5)*20*l,j=Math.sin(d.current*15+y)>.8?Math.random()*40*l:0,I=10+(T+v+j);return Math.max(5,Math.min(100,I))});f(w),p(l),i.current=requestAnimationFrame(g)};return r.useEffect(()=>(i.current=requestAnimationFrame(g),()=>{i.current&&cancelAnimationFrame(i.current)}),[x]),e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden select-none z-0",children:[e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full blur-[160px] bg-primary/30 transition-all duration-1000",style:{width:`${500+t*600}px`,height:`${500+t*600}px`,opacity:.05+t*.2}}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-64 flex items-end justify-center gap-[4px] px-12 opacity-30",children:c.map((n,u)=>e.jsx("div",{className:"flex-1 bg-gradient-to-t from-primary/80 via-primary/20 to-transparent rounded-t-full transition-all duration-75",style:{height:`${n}%`,opacity:.3+n/100*.7}},u))})]})},ce=({showToast:x})=>{var $,Y;const{id:c}=q(),f=U(),[t,p]=r.useState(null),[i,d]=r.useState(null),[m,g]=r.useState([]),[n,u]=r.useState(!0),[l,w]=r.useState(!1),[A,y]=r.useState(!1),[S,T]=r.useState([]),[v,j]=r.useState(!1),[I,L]=r.useState(!1),[o,_]=r.useState(null),[k,G]=r.useState(!1),[te,V]=r.useState(0),[se,W]=r.useState(0),[re,F]=r.useState(100),[ae,ie]=r.useState(!1),[B,C]=r.useState(!0),R=r.useRef(null),J=async()=>{if(c)try{u(!0);const s=await z.getInfo(c);p(s);const a=JSON.parse(localStorage.getItem("watchlist")||"[]");w(a.some(N=>N.id===c));const b=JSON.parse(localStorage.getItem("favorites")||"[]");y(b.some(N=>N.id===c));const h=JSON.parse(localStorage.getItem("anime_history")||"{}");T(h[c]||[]);const E=typeof s.title=="string"?s.title:s.title.english||"";Z.getAnimeInsight(E,s.description||"").then(N=>{N&&(d(N.data),g(N.sources))})}catch(s){console.error(s)}finally{u(!1)}};r.useEffect(()=>{J()},[c]),r.useEffect(()=>{const s=a=>{v&&(C(!0),P(),a.code==="Space"&&(a.preventDefault(),k?o==null||o.pauseVideo():o==null||o.playVideo()),a.code==="Escape"&&j(!1))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[v,o,k]),r.useEffect(()=>{var s,a;if(v&&((s=t==null?void 0:t.trailer)!=null&&s.id)){const b=()=>{o||new window.YT.Player("trailer-player",{videoId:t.trailer.id,playerVars:{autoplay:1,controls:0,modestbranding:1,rel:0,enablejsapi:1},events:{onReady:h=>{_(h.target),W(h.target.getDuration()),F(h.target.getVolume())},onStateChange:h=>{G(h.data===window.YT.PlayerState.PLAYING),h.data===window.YT.PlayerState.ENDED&&j(!1)}}})};if(window.YT)b();else{const h=document.createElement("script");h.src="https://www.youtube.com/iframe_api";const E=document.getElementsByTagName("script")[0];(a=E.parentNode)==null||a.insertBefore(h,E),window.onYouTubeIframeAPIReady=b}}return()=>o==null?void 0:o.destroy()},[v,t]),r.useEffect(()=>{let s;return k&&o&&(s=window.setInterval(()=>{V(o.getCurrentTime())},200)),()=>clearInterval(s)},[k,o]);const P=()=>{R.current&&clearTimeout(R.current),R.current=window.setTimeout(()=>{k&&C(!1)},4e3)},D=async()=>{if(t){L(!0);try{const s=await z.getInfo(t.id);if(p(s),s.episodes&&s.episodes.length>0){const a=s.episodes.find(b=>!S.includes(b.id))||s.episodes[0];f(`/watch/${a.id}?animeId=${t.id}`)}else x("No active stream signal found.")}catch{x("Sync error.")}finally{L(!1)}}},K=()=>{if(!t)return;const s=JSON.parse(localStorage.getItem("watchlist")||"[]");let a=l?s.filter(b=>b.id!==t.id):[...s,t];localStorage.setItem("watchlist",JSON.stringify(a)),w(!l),x(l?"Removed from list":"Added to list")},M=r.useMemo(()=>{if(!t||!t.episodes)return{count:0,percent:0};const s=t.episodes.filter(a=>S.includes(a.id)).length;return{count:s,total:t.episodes.length,percent:s/t.episodes.length*100}},[t,S]);if(n)return e.jsx("div",{className:"flex items-center justify-center h-[80vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-white/5 border-t-primary"})});if(!t)return null;const O=typeof t.title=="string"?t.title:t.title.english||t.title.romaji;return e.jsxs("div",{className:"pb-20",children:[v&&t.trailer&&e.jsxs("div",{className:"fixed inset-0 z-[500] flex items-center justify-center p-4 md:p-12 animate-fade-in",onMouseMove:()=>{C(!0),P()},children:[e.jsx("div",{className:"absolute inset-0 bg-black/95 backdrop-blur-3xl",onClick:()=>j(!1)}),e.jsx(ee,{isActive:k}),e.jsxs("div",{className:"relative w-full max-w-7xl aspect-video bg-black rounded-[3rem] overflow-hidden shadow-2xl border border-white/10 z-10",children:[e.jsx("div",{id:"trailer-player",className:"w-full h-full scale-105"}),e.jsx("div",{className:`absolute inset-0 z-20 flex flex-col justify-between transition-opacity duration-700 ${B?"opacity-100":"opacity-0"}`,children:e.jsxs("div",{className:"p-10 flex justify-between bg-gradient-to-b from-black/80 to-transparent",children:[e.jsx("h2",{className:"text-3xl font-black text-white",children:O}),e.jsx("button",{onClick:()=>j(!1),className:"p-4 bg-white/5 rounded-2xl text-white hover:bg-red-500/20 transition-all border border-white/10",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})]})})]})]}),e.jsxs("div",{className:"relative w-full h-[70vh] flex items-end overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background-dark via-background-dark/40 to-transparent z-10"}),e.jsx("img",{src:t.image,className:"absolute inset-0 w-full h-full object-cover blur-3xl opacity-20 scale-125"}),e.jsx("div",{className:"relative z-20 w-full max-w-7xl mx-auto px-6 pb-16",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-12 items-end",children:[e.jsx("div",{className:"w-64 aspect-[3/4.5] rounded-[2.5rem] overflow-hidden shadow-2xl border border-white/10 group cursor-pointer",onClick:D,children:e.jsx("img",{src:t.image,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"px-4 py-1.5 bg-primary/20 text-primary border border-primary/30 text-[10px] font-black rounded-full uppercase",children:t.type}),e.jsxs("span",{className:"text-yellow-500 font-black",children:["â˜… ",(t.rating||0)/10]})]}),e.jsx("h1",{className:"text-5xl md:text-7xl font-black text-white tracking-tighter drop-shadow-2xl",children:O}),e.jsx("div",{className:"flex flex-wrap gap-2",children:($=t.genres)==null?void 0:$.map(s=>e.jsx("span",{className:"px-5 py-2 bg-white/5 border border-white/10 rounded-2xl text-xs font-bold text-slate-300",children:s},s))})]})]})})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 mt-16 grid grid-cols-1 lg:grid-cols-12 gap-16",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-16",children:[i&&e.jsxs("div",{className:"bg-card-dark/80 p-8 md:p-12 rounded-[2.5rem] border border-white/5 shadow-2xl animate-fade-in",children:[e.jsx("span",{className:"text-primary font-black uppercase text-[10px] tracking-widest mb-4 block",children:"Neural Insight"}),e.jsx("p",{className:"text-white text-3xl font-black italic leading-tight pl-6 border-l-4 border-primary/40 mb-8",children:i.hook}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-4 pt-6 border-t border-white/5",children:m.map((s,a)=>e.jsxs("a",{href:s.uri,target:"_blank",className:"text-[10px] font-bold text-primary hover:underline flex items-center gap-1 bg-primary/5 px-3 py-1.5 rounded-lg border border-primary/10 transition-colors",children:[e.jsx("span",{className:"material-symbols-outlined text-xs",children:"link"}),s.title]},a))})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-black text-white mb-8",children:"Synopsis"}),e.jsx("div",{className:"text-slate-300 text-lg leading-relaxed prose prose-invert max-w-none",dangerouslySetInnerHTML:{__html:t.description||""}})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-10",children:[e.jsx("h2",{className:"text-3xl font-black text-white",children:"Episodes"}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("span",{className:"text-[10px] font-black text-slate-500 uppercase",children:[M.count," / ",M.total," WATCHED"]}),e.jsx("div",{className:"w-48 h-1.5 bg-white/5 rounded-full overflow-hidden border border-white/5",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-1000",style:{width:`${M.percent}%`}})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(Y=t.episodes)==null?void 0:Y.map((s,a)=>e.jsxs(Q,{to:`/watch/${s.id}?animeId=${t.id}`,className:"group relative flex gap-6 bg-card-dark/40 border border-white/5 rounded-[2.2rem] p-5 hover:border-primary/40 hover:-translate-y-2 transition-all animate-fade-in",style:{animationDelay:`${a*50}ms`},children:[e.jsxs("div",{className:"relative w-32 aspect-video rounded-2xl overflow-hidden bg-slate-800 border border-white/5",children:[e.jsx("img",{src:s.image||t.image,className:"w-full h-full object-cover opacity-70 group-hover:opacity-100 transition-all"}),S.includes(s.id)&&e.jsx("div",{className:"absolute top-2 right-2 size-6 rounded-lg bg-primary text-white flex items-center justify-center shadow-lg border border-white/10",children:e.jsx("span",{className:"material-symbols-outlined !text-base",children:"check"})})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[e.jsxs("span",{className:"text-[9px] font-black text-primary uppercase mb-1",children:["EP ",s.number]}),e.jsx("h4",{className:"text-white font-black text-base line-clamp-1",children:s.title||`Episode ${s.number}`})]})]},s.id))})]})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsxs("div",{className:"bg-card-dark rounded-[2.5rem] p-10 border border-white/5 sticky top-28 shadow-2xl space-y-8",children:[e.jsx("h3",{className:"text-2xl font-black text-white pb-4 border-b border-white/5 uppercase",children:"Status Matrix"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500 uppercase text-[10px] font-black",children:"Status"}),e.jsx("span",{className:"text-white font-black",children:t.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500 uppercase text-[10px] font-black",children:"Type"}),e.jsx("span",{className:"text-white font-black",children:t.type})]})]}),e.jsxs("button",{onClick:D,disabled:I,className:"w-full bg-primary py-6 rounded-[2rem] text-white font-black text-sm tracking-widest hover:bg-primary/90 transition-all flex items-center justify-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined !text-3xl",children:I?"sync":"play_circle"}),I?"SYNCING...":"WATCH NOW"]}),e.jsx("button",{onClick:K,className:`w-full py-5 rounded-2xl font-black text-[11px] border transition-all ${l?"bg-primary/10 border-primary/20 text-primary":"bg-white/5 border-white/10 text-white"}`,children:l?"SAVED":"MY LIST"}),t.trailer&&e.jsx("button",{onClick:()=>j(!0),className:"w-full py-5 rounded-2xl bg-white/5 border border-white/10 text-white font-black text-[11px] hover:bg-white/10",children:"TRAILER"})]})})]})]})};export{ce as default};
