import{c as H,j as e}from"./index-C9gtmVr_.js";import{b as n}from"./vendor-Btvvx3Fo.js";import{A as O}from"./AnimeCard-BLGU72lj.js";const T=["Action","Adventure","Comedy","Drama","Fantasy","Horror","Mystery","Psychological","Romance","Sci-Fi","Slice of Life","Sports","Supernatural","Thriller"],R=1e3*60*60*4,z=1e3*60*60*24*7,$=({showToast:h})=>{const[a,N]=n.useState([]),[I,A]=n.useState({}),[x,b]=n.useState({}),[M,y]=n.useState(!1),[j,w]=n.useState(!1),[D,S]=n.useState(0),[u,k]=n.useState(null);n.useEffect(()=>{const t=JSON.parse(localStorage.getItem("watchlist")||"[]"),s=JSON.parse(localStorage.getItem("anime_history")||"{}"),r=JSON.parse(localStorage.getItem("watchlist_meta_cache")||"{}");N(t),A(s),b(r)},[]);const E=n.useMemo(()=>u?a.filter(t=>{var s;return(s=t.genres)==null?void 0:s.some(r=>r.toLowerCase().includes(u.toLowerCase()))}):a,[a,u]),v=n.useCallback(async(t,s=!1)=>{if(t.length===0)return;s?(w(!0),S(0)):y(!0);const r=Date.now(),o={...x};let m=0;const d=t.filter(l=>{const c=o[l.id];if(!c)return!0;if(!s)return!1;const i=r-c.lastUpdated,g=(c.status||l.status||"").toUpperCase();return g==="COMPLETED"||g==="FINISHED"?i>z:i>R});if(d.length===0){y(!1),w(!1),s&&h("Archive is already up to date.");return}const f=3;for(let l=0;l<d.length;l+=f){const c=d.slice(l,l+f);await Promise.all(c.map(async i=>{var g;try{const p=await H.getInfo(i.id);if(p&&p.episodes){const C=p.episodes.length,_=((g=o[i.id])==null?void 0:g.totalEpisodes)||0;_>0&&C>_&&m++,o[i.id]={totalEpisodes:C,episodes:p.episodes,lastUpdated:Date.now(),status:p.status||i.status},b(P=>({...P,[i.id]:o[i.id]}))}}catch(p){console.error("Sync error:",p)}})),s&&S(Math.round((l+c.length)/d.length*100))}localStorage.setItem("watchlist_meta_cache",JSON.stringify(o)),y(!1),w(!1),s&&(m>0?h(`Found ${m} new episode updates!`):h("Synchronized with master database."))},[x,h]);n.useEffect(()=>{a.length>0&&a.some(s=>!x[s.id])&&v(a,!1)},[a,v,x]);const L=()=>{window.confirm("Purge collection database? All tracking for saved titles will be removed.")&&(localStorage.setItem("watchlist","[]"),localStorage.removeItem("watchlist_meta_cache"),N([]),b({}),h("Watchlist purged"))},F=t=>{var l;const s=I[t.id]||[],r=x[t.id],o=(r==null?void 0:r.totalEpisodes)||((l=t.episodes)==null?void 0:l.length)||0,m=s.length;let d;if(s.length>0&&(r!=null&&r.episodes)){const c=r.episodes.filter(i=>s.includes(i.id));c.length>0&&(d=Math.max(...c.map(i=>i.number)))}const f=o>0?Math.round(m/o*100):0;return{watched:m,total:o,lastWatchedNumber:d,percent:f}};return e.jsxs("div",{className:"p-8 md:p-12 pb-32",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center mb-16 gap-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"size-14 bg-primary/20 rounded-[1.5rem] flex items-center justify-center border border-primary/30 shadow-[0_0_30px_rgba(168,85,247,0.1)]",children:e.jsx("span",{className:"material-symbols-outlined !text-3xl text-primary",children:"bookmark"})}),e.jsx("h1",{className:"text-5xl font-black text-white tracking-tighter",children:"My Archive"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 pl-1",children:[e.jsxs("p",{className:"text-slate-500 font-bold uppercase tracking-widest text-[10px]",children:["Tracking ",a.length," active links"]}),M||j?e.jsx("div",{className:"flex items-center gap-4 bg-primary/5 px-4 py-2 rounded-2xl border border-primary/20 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx("span",{className:"material-symbols-outlined text-sm animate-spin",children:"refresh"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:j?`Neural Sync ${D}%`:"Verifying Signal..."})]})}):a.length>0?e.jsxs("button",{onClick:()=>v(a,!0),className:"flex items-center gap-2 bg-white/5 hover:bg-primary/20 text-slate-400 hover:text-primary px-4 py-2 rounded-2xl border border-white/10 hover:border-primary/40 transition-all group",children:[e.jsx("span",{className:"material-symbols-outlined text-sm group-hover:rotate-180 transition-transform duration-700",children:"sync"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Update Archive"})]}):null]})]}),a.length>0&&e.jsxs("button",{onClick:L,className:"text-[10px] font-black text-red-500/60 hover:text-red-500 flex items-center gap-2 bg-red-500/5 px-6 py-3 rounded-2xl border border-red-500/10 hover:border-red-500/30 transition-all uppercase tracking-[0.2em]",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"delete_sweep"}),"Purge Collection"]})]}),a.length>0&&e.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto hide-scrollbar pb-8 mb-8 border-b border-white/5",children:[e.jsx("button",{onClick:()=>k(null),className:`px-8 py-3 rounded-2xl text-[10px] font-black tracking-widest uppercase transition-all whitespace-nowrap border ${u?"bg-white/5 border-white/10 text-slate-500 hover:text-white":"bg-primary border-primary text-white shadow-lg shadow-primary/20"}`,children:"All Series"}),T.map(t=>e.jsx("button",{onClick:()=>k(t),className:`px-8 py-3 rounded-2xl text-[10px] font-black tracking-widest uppercase transition-all whitespace-nowrap border ${u===t?"bg-primary border-primary text-white shadow-lg shadow-primary/20":"bg-white/5 border-white/10 text-slate-500 hover:text-white"}`,children:t},t))]}),e.jsx("div",{className:"mt-8",children:a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-32 text-center",children:[e.jsxs("div",{className:"size-24 bg-white/5 rounded-[2.5rem] flex items-center justify-center mb-8 border border-white/10 relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/5 blur-2xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("span",{className:"material-symbols-outlined text-5xl text-slate-700 relative z-10",children:"bookmark_add"})]}),e.jsx("h2",{className:"text-3xl font-black text-white mb-4 uppercase tracking-tighter",children:"Archive Empty"}),e.jsx("p",{className:"text-slate-500 max-w-xs mx-auto mb-10 text-sm font-medium leading-relaxed",children:"Your neural archive is awaiting content. Discovery mode is active."}),e.jsx("button",{onClick:()=>window.location.hash="#/",className:"bg-primary hover:bg-primary/90 text-white font-black px-12 py-5 rounded-[2rem] shadow-2xl shadow-primary/40 transition-all active:scale-95 text-[11px] tracking-[0.2em] uppercase",children:"Enter Multiverse"})]}):E.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-7 gap-x-10 gap-y-16 animate-fade-in",children:E.map(t=>e.jsx(O,{anime:t,progress:F(t)},t.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-32 text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-700 text-6xl mb-6",children:"filter_list_off"}),e.jsx("p",{className:"text-slate-500 font-black uppercase tracking-[0.2em] text-xs",children:"No matching nodes in this sector."})]})})]})};export{$ as default};
